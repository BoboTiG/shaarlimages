function makeLight(){"use strict";var e,t=document.getElementsByTagName("img")[0],i=document.createElement("canvas"),o=i.getContext("2d"),n="assets/img/mask.png",s=new Image,a=100,r=function(e,t,i){var o,n=[0,0,0],s=(i-t)/4;for(o=t;i>=o;o+=4)n[0]+=e[o],n[1]+=e[o+1],n[2]+=e[o+2];return n[0]=Math.round(n[0]/s),n[1]=Math.round(n[1]/s),n[2]=Math.round(n[2]/s),n},l=function(e,t,i){var o,n,s=e.width,a=e.height,l=5,c=Math.ceil(a/l),d=4*i*c,u=[],p=t.getImageData(0,0,i,a),h=p.data.length;for(o=0;l>o;o+=1)n=o*s*i,u.push(r(p.data,o*d,Math.min((o+1)*d,h-1)));return u},c=function(e,i){var o,n,s,a,r=e,c=document.createElement("canvas"),d=c.getContext("2d");for(c.style.position="absolute",c.style.top="0",c.style.zIndex="-2",c.style.width="100%",c.style.height="100%",c.width=e,c.height=t.height,i&&(r=t.width-e),d.drawImage(t,r,0,c.width,c.height,0,0,c.width,c.height),s=l(c,d,e),a=d.createLinearGradient(0,0,0,c.height),o=0,n=s.length;n>o;o+=1)a.addColorStop(o/n,"rgb("+s[o]+")");return d.fillStyle=a,d.fillRect(0,0,c.width,c.height),c};e=c(a,!1),e.style.left="0",document.body.appendChild(e),i.style.position="absolute",i.style.top="0",i.style.left="0",i.style.zIndex="-1",i.style.width="100%",i.style.height="100%",s.src=n,i.width=s.width,i.height=s.height,o.drawImage(s,0,0,i.width,i.height),document.body.appendChild(i)}function addEvent(e,t,i){"use strict";return e.attachEvent?e.attachEvent("on"+t,i):e.addEventListener(t,i,!1)}function curr_prev_next(e){"use strict";var t,i=gallery.length,o=!1,n=!1,s=!1;for(t=0;i>t;t+=1)if(gallery[t].key===e){o=gallery[t],t>0&&(n=gallery[t-1]),i-1>t&&(s=gallery[t+1]);break}return{current:o,previous:n,next:s}}function parse_date(e){"use strict";var t=new Date(1e3*e),i=t.getFullYear().toString(),o=(t.getMonth()+1).toString(),n=t.getDate().toString();return 1===o.length&&(o="0"+o),1===n.length&&(n="0"+n),i+o+n}var linearPartitionTable=function(e,t){"use strict";var i,o,n,s,a=e.length,r=[],l=[],c=[],d=[],u={};for(i=0;a>i;i+=1){for(r=[],o=0;t>o;o+=1)r.push(0);l.push(r)}for(i=0;a-1>i;i+=1){for(r=[],o=0;t-1>o;o+=1)r.push(0);c.push(r)}for(i=0;a>i;i+=1)l[i][0]=e[i]+(i?l[i-1][0]:0);for(i=0;t>i;i+=1)l[0][i]=e[0];for(i=1;a>i;i+=1)for(o=1;t>o;o+=1){for(d=[],n=0;i>n;n+=1)d.push([Math.max(l[n][o-1],l[i][0]-l[n][0]),n]);for(u={computed:1/0,value:1/0},n=0,s=d.length;s>n;n+=1)d[n][0]<u.computed&&(u={value:d[n],computed:d[n][0]});l[i][o]=u.value[0],c[i-1][o-1]=u.value[1]}return[l,c]},linearPartition=function(e,t){"use strict";var i,o,n,s=e.length-1,a=[],r=[],l=[];if(1>t)return r;if(t>s){for(i=0;s>=i;i+=1)r.push([e[i]]);return r}for(n=linearPartitionTable(e,t),o=n[1],t-=2;t>=0;){for(l=[],i=o[s-1][t]+1;s>=i;i+=1)l.push(e[i]);l=[l],a=l.concat(a),s=o[s-1][t],t-=1}for(i=0;s>=i;i+=1)r.push(e[i]);return r=[r],r.concat(a)},linearPartitionFitPics=function(e,t){"use strict";t.border=t.border||0,t.spacing=t.spacing||0;var i,o,n,s,a,r,l,c,d=0,u=0,p=0,h=[],f=[];for(i=0,n=e.length;n>i;i+=1)e[i].aspectRatio=e[i].width/e[i].height,u+=e[i].aspectRatio*t.preferedImageHeight;if(a=Math.round(u/t.containerWidth),1>=a)for(i=0,n=e.length;n>i;i+=1)e[i].width=parseInt(t.preferedImageHeight*e[i].aspectRatio,10),e[i].height=t.preferedImageHeight;else{for(i=0,n=e.length;n>i;i+=1)h.push(parseInt(100*e[i].aspectRatio,10));s=linearPartition(h,a);for(i in s){for(r=s[i],l=t.containerWidth,p=0,f=[],n=r.length,t.spacing&&(l-=t.spacing*(n-1)),o=0;n>o;o+=1)f.push(e[d]),d+=1;for(o=0,n=f.length;n>o;o+=1)p+=f[o].aspectRatio;for(o=0;n>o;o+=1)c=f[o],c.width=parseInt(l/p*c.aspectRatio,10),c.height=parseInt(l/p,10),o===n-1&&(c.last=!0)}}return e},parse_query_string=function(){"use strict";var e=window.location.search,t={};return e.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),function(e,i,o,n){t[i]=n}),t},params=parse_query_string();if(!galinear_opt)var galinear_opt={gallery_url:"/",img_folder:"images/",thumb_folder:"images/thumbs/",per_page:20,lines:3,show_nsfw:0,toolbar:1,use_ambilight:1,txt_no_img:"Aucune image ☹",txt_older:"◄ Vieilleries",txt_newer:"Nouveautés ►",txt_home:"Retour à la galerie",txt_permalink:"Lien source",txt_source:"Image originale",touch_support:"ontouchend"in document};if(params.per_page&&(galinear_opt.per_page=parseInt(params.per_page,10),galinear_opt.per_page<10&&(galinear_opt.per_page=10)),params.lines&&(galinear_opt.lines=parseInt(params.lines,10),galinear_opt.lines<2&&(galinear_opt.lines=2)),params.show_nsfw&&(galinear_opt.show_nsfw=parseInt(params.show_nsfw,10),1!==galinear_opt.show_nsfw&&(galinear_opt.show_nsfw=0)),params.toolbar&&(galinear_opt.toolbar=parseInt(params.toolbar,10),1!==galinear_opt.toolbar&&(galinear_opt.toolbar=0)),params.al&&(galinear_opt.use_ambilight=parseInt(params.al,10),1!==galinear_opt.use_ambilight&&(galinear_opt.use_ambilight=0)),navigator.cookieEnabled&&document.cookie.length>0,params.i&&gallery.length>0){adjust_me=function(){"use strict";var e=document.getElementsByClassName("image-container-alone")[0],t=e.getElementsByTagName("img")[0];t.width<document.documentElement.clientWidth-2&&(t.style.borderLeft="1px solid #111",t.style.borderRight="1px solid #111"),t.height<document.documentElement.clientHeight-2&&(t.style.borderTop="1px solid #111",t.style.borderBottom="1px solid #111"),galinear_opt.use_ambilight&&makeLight()};var figure,img,title,toolbar,home,permalink,source,previous,next,curr_prev_next_img=curr_prev_next(params.i),image=curr_prev_next_img.current,start=0;image===!1?document.write("<p>"+galinear_opt.txt_no_img+"</p>"):(title=image.src,image.nsfw&&(title+=" [ ☂ NSFW ]"),title+=" - "+document.title,document.title=title,galinear_opt.use_ambilight||(image.docolav||(image.docolav="222"),document.body.style.background="#"+image.docolav+" url(assets/img/bg.png)",document.body.style.transition="1s"),img=document.createElement("img"),img.src=galinear_opt.img_folder+image.src,figure=document.createElement("figure"),figure.className="image-container-alone",figure.appendChild(img),document.body.appendChild(figure),galinear_opt.touch_support?(addEvent(document,"touchstart",function(e){start=e.targetTouches[0].clientX},!1),addEvent(document,"touchmove",function(e){e.preventDefault(),start-e.targetTouches[0].clientX<0?curr_prev_next_img.previous!==!1&&(document.location="?i="+curr_prev_next_img.previous.key):curr_prev_next_img.next!==!1&&(document.location="?i="+curr_prev_next_img.next.key)},!1)):(curr_prev_next_img.previous!==!1&&(previous=document.createElement("a"),previous.className="image-container-previous",previous.href="?i="+curr_prev_next_img.previous.key,previous.text="◄",document.body.appendChild(previous)),curr_prev_next_img.next!==!1&&(next=document.createElement("a"),next.className="image-container-next",next.href="?i="+curr_prev_next_img.next.key,next.text="►",document.body.appendChild(next)),document.onkeydown=function(e){switch(e=e||window.event,e.which||e.keyCode){case 37:curr_prev_next_img.previous!==!1&&(document.location="?i="+curr_prev_next_img.previous.key);break;case 39:curr_prev_next_img.next!==!1&&(document.location="?i="+curr_prev_next_img.next.key)}}),galinear_opt.toolbar&&(home=document.createElement("a"),home.className="home",home.href=galinear_opt.gallery_url,home.title=galinear_opt.txt_home,permalink=document.createElement("a"),permalink.className="permalink",image.guid&&(permalink.href=image.guid),permalink.title=galinear_opt.txt_permalink,source=document.createElement("a"),source.className="source",source.href=img.src,source.title=galinear_opt.txt_source,toolbar=document.createElement("div"),toolbar.className="image-container-alone-toolbar",toolbar.appendChild(home),toolbar.appendChild(permalink),toolbar.appendChild(source),document.body.appendChild(toolbar))),window.onload=adjust_me,window.onresize=adjust_me}else{var gallery_images=[];linear_me=function(){"use strict";var e,t,i,o,n,s,a,r,l,c="",d=0,u=1,p=0,h=gallery.length,f=document.getElementById("image-container"),m=Math.ceil(h/galinear_opt.per_page);if(params.p&&!params.d&&(u=parseInt(params.p,10),1>u&&(u=1),u>m&&(u=m),p=(u-1)*galinear_opt.per_page),0===gallery_images.length){if(params.d){for(l=[],e=0;h>e;e+=1)parse_date(gallery[e].date)===params.d&&l.push(gallery[e]);gallery=l,h=gallery.length}for(e=p;h>e&&d<galinear_opt.per_page;e+=1,d+=1)s=document.createElement("img"),s.width=gallery[e].w,s.height=gallery[e].h,n=document.createElement("a"),n.href="?i="+gallery[e].key,n.appendChild(s),o=document.createElement("figure"),o.appendChild(n),gallery[e].nsfw&&!galinear_opt.show_nsfw&&(o.className="nsfw",o.title="/!\\ NSFW /!\\"),f.appendChild(o),gallery_images.push({originalImage:f.getElementsByTagName("figure")[d].getElementsByTagName("img")[0],width:gallery[e].w,height:gallery[e].h,nsfw:gallery[e].nsfw})}if(0===h)return document.write("<p>"+galinear_opt.txt_no_img+"</p>"),void 0;for(r=linearPartitionFitPics(gallery_images,{containerWidth:document.documentElement.clientWidth-16,preferedImageHeight:parseInt((document.documentElement.clientHeight-25)/galinear_opt.lines,10),spacing:4}),i=f.getElementsByTagName("figure"),e=0,h=gallery_images.length;h>e;e+=1)t=gallery_images[e],t.originalImage.width=r[e].width,t.originalImage.height=r[e].height,gallery_images[e].nsfw&&!galinear_opt.show_nsfw&&(o=document.getElementsByTagName("figure")[e],r[e].width<95&&(o.style.backgroundSize="contain")),t.originalImage.src=galinear_opt.thumb_folder+gallery[p+e].src,t.last||(i[e].style.marginRight="4px");params.d||(a=document.createElement("div"),u>0&&m>u&&(c+='<a href="?p='+(u+1)+'">'+galinear_opt.txt_older+"</a> &nbsp; "),c+=" &nbsp; page "+u+"/"+m+" &nbsp; ",u>1&&(c+=' &nbsp; <a href="?p='+(u-1)+'">'+galinear_opt.txt_newer+"</a>"),a.innerHTML=c,a.className="pagination",f.appendChild(a)),galinear_opt.touch_support||(document.onkeydown=function(e){switch(e=e||window.event,e.which||e.keyCode){case 37:u>0&&m>u&&(document.location="?p="+(u+1));break;case 39:u>1&&(document.location="?p="+(u-1))}})},window.onload=linear_me,window.onresize=linear_me}
