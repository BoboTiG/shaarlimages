function linearPartitionFitPics(e,t){"use strict";t.border=t.border||0,t.spacing=t.spacing||0;var i,s,n,o,a,r,c,l,p=0,d=0,u=0,f=[],m=[],g=function(e,t){var i,s,n,o,a=e.length,r=[],c=[],l=[],p=[],d={};for(i=0;a>i;i+=1){for(r=[],s=0;t>s;s+=1)r.push(0);c.push(r)}for(i=0;a-1>i;i+=1){for(r=[],s=0;t-1>s;s+=1)r.push(0);l.push(r)}for(i=0;a>i;i+=1)c[i][0]=e[i]+(i?c[i-1][0]:0);for(i=0;t>i;i+=1)c[0][i]=e[0];for(i=1;a>i;i+=1)for(s=1;t>s;s+=1){for(p=[],n=0;i>n;n+=1)p.push([Math.max(c[n][s-1],c[i][0]-c[n][0]),n]);for(d={computed:1/0,value:1/0},n=0,o=p.length;o>n;n+=1)p[n][0]<d.computed&&(d={value:p[n],computed:p[n][0]});c[i][s]=d.value[0],l[i-1][s-1]=d.value[1]}return[c,l]},h=function(e,t){var i,s,n,o=e.length-1,a=[],r=[],c=[];if(1>t)return r;if(t>o){for(i=0;o>=i;i+=1)r.push([e[i]]);return r}for(n=g(e,t),s=n[1],t-=2;t>=0;){for(c=[],i=s[o-1][t]+1;o>=i;i+=1)c.push(e[i]);c=[c],a=c.concat(a),o=s[o-1][t],t-=1}for(i=0;o>=i;i+=1)r.push(e[i]);return r=[r],r.concat(a)};for(i=0,n=e.length;n>i;i+=1)e[i].aspectRatio=e[i].width/e[i].height,d+=e[i].aspectRatio*t.preferedImageHeight;if(a=Math.round(d/t.containerWidth),1>=a)for(i=0,n=e.length;n>i;i+=1)e[i].width=parseInt(t.preferedImageHeight*e[i].aspectRatio,10),e[i].height=t.preferedImageHeight;else{for(i=0,n=e.length;n>i;i+=1)f.push(parseInt(100*e[i].aspectRatio,10));o=h(f,a);for(i in o){for(r=o[i],c=t.containerWidth,u=0,m=[],n=r.length,t.spacing&&(c-=t.spacing*(n-1)),s=0;n>s;s+=1)m.push(e[p]),p+=1;for(s=0,n=m.length;n>s;s+=1)u+=m[s].aspectRatio;for(s=0;n>s;s+=1)l=m[s],l.width=parseInt(c/u*l.aspectRatio,10),l.height=parseInt(c/u,10),s===n-1&&(l.last=!0)}}return e}function ambilight_effect(){"use strict";var e,t=document.getElementsByTagName("img")[0],i=document.createElement("canvas"),s=i.getContext("2d"),n="assets/img/mask.png",o=new Image,a=150,r=function(e,t,i){var s,n=[0,0,0],o=(i-t)/4;for(s=t;i>=s;s+=4)n[0]+=e[s],n[1]+=e[s+1],n[2]+=e[s+2];return n[0]=Math.round(n[0]/o),n[1]=Math.round(n[1]/o),n[2]=Math.round(n[2]/o),n},c=function(e,t,i){var s,n,o=e.width,a=e.height,c=5,l=Math.ceil(a/c),p=4*i*l,d=[],u=t.getImageData(0,0,i,a),f=u.data.length;for(s=0;c>s;s+=1)n=s*o*i,d.push(r(u.data,s*p,Math.min((s+1)*p,f-1)));return d},l=function(e,i){var s,n,o,a,r=e,l=document.createElement("canvas"),p=l.getContext("2d");for(l.style.position="absolute",l.style.top="0",l.style.zIndex="-2",l.style.width="100%",l.style.height="100%",l.width=e,l.height=t.height,i&&(r=t.width-e),p.drawImage(t,r,0,l.width,l.height,0,0,l.width,l.height),o=c(l,p,e),a=p.createLinearGradient(0,0,0,l.height),s=0,n=o.length;n>s;s+=1)a.addColorStop(s/n,"rgb("+o[s]+")");return p.fillStyle=a,p.fillRect(0,0,l.width,l.height),l};e=l(a,!1),e.style.left="0",document.body.appendChild(e),i.style.position="absolute",i.style.top="0",i.style.left="0",i.style.zIndex="-1",i.style.width="100%",i.style.height="100%",o.src=n,i.width=o.width,i.height=o.height,s.drawImage(o,0,0,i.width,i.height),document.body.appendChild(i)}function parse_query_string(){"use strict";var e=window.location.search,t={};return e.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),function(e,i,s,n){t[i]=n}),t}function add_event(e,t,i){"use strict";return e.attachEvent?e.attachEvent("on"+t,i):e.addEventListener(t,i,!1)}function parse_date(e){"use strict";var t=new Date(1e3*e),i=t.getFullYear().toString(),s=(t.getMonth()+1).toString(),n=t.getDate().toString();return 1===s.length&&(s="0"+s),1===n.length&&(n="0"+n),i+s+n}function store_cookie(){"use strict";var e=new Date,t=new Date(e.getTime()+31536e6),i="prefs="+JSON.stringify(galinear_prefs)+";expires="+t+";";navigator.cookieEnabled&&(document.cookie=i)}function read_cookie(){"use strict";var e,t,i;if(navigator.cookieEnabled&&document.cookie.length>0){i=document.cookie.split("; ");for(e in i)if("prefs"==i[e].split("=")[0]){t=JSON.parse(i[e].split("=")[1]);for(e in t)t[e]=parseInt(t[e],10),isNaN(t[e])&&(t[e]=0);return t}}return galinear_prefs}if(!galinear_opt)var galinear_opt={gallery_url:"/",img_folder:"images/",thumb_folder:"images/thumbs/",txt_no_img:"Aucune image ☹",txt_older:"◄ Vieilleries",txt_newer:"Nouveautés ►",txt_home:"Retour à la galerie",txt_permalink:"Lien source",txt_source:"Image originale",txt_pref_toolbar:"La barre d'outils est affichée",txt_pref_toolbar_no:"La barre d'outils n'est pas affichée",txt_pref_show_nsfw:"Les images sensibles ne sont pas filtrées",txt_pref_show_nsfw_no:"Les images sensibles sont filtrées",touch_support:"ontouchend"in document};if(!galinear_prefs)var galinear_prefs={per_page:20,lines:3,show_nsfw:0,toolbar:1};var params=parse_query_string();if(params.per_page&&(galinear_prefs.per_page=parseInt(params.per_page,10)),params.lines&&(galinear_prefs.lines=parseInt(params.lines,10)),params.show_nsfw&&(galinear_prefs.show_nsfw=parseInt(params.show_nsfw,10)),params.toolbar&&(galinear_prefs.toolbar=parseInt(params.toolbar,10)),galinear_prefs=read_cookie(),galinear_prefs.per_page<10&&(galinear_prefs.per_page=10),galinear_prefs.lines<2&&(galinear_prefs.lines=2),1!==galinear_prefs.show_nsfw&&(galinear_prefs.show_nsfw=0),1!==galinear_prefs.toolbar&&(galinear_prefs.toolbar=0),params.i&&gallery.length>0){var figure,img,title,toolbar,home,permalink,source,previous,next,start=0,curr_prev_next=function(e){var t,i=gallery.length,s=!1,n=!1,o=!1;for(t=0;i>t;t+=1)if(gallery[t].key===e){s=gallery[t],t>0&&(n=gallery[t-1]),i-1>t&&(o=gallery[t+1]);break}return{current:s,previous:n,next:o}},curr_prev_next_img=curr_prev_next(params.i),image=curr_prev_next_img.current;image===!1?document.write("<p>"+galinear_opt.txt_no_img+"</p>"):(title=image.src,image.nsfw&&(title+=" [ ☂ NSFW ]"),title+=" - "+document.title,document.title=title,img=document.createElement("img"),img.src=galinear_opt.img_folder+image.src,figure=document.createElement("figure"),figure.className="image-container-alone",figure.appendChild(img),document.body.appendChild(figure),galinear_opt.touch_support?(add_event(document,"touchstart",function(e){start=e.targetTouches[0].clientX},!1),add_event(document,"touchmove",function(e){e.preventDefault(),start-e.targetTouches[0].clientX<0?curr_prev_next_img.previous!==!1&&(document.location="?i="+curr_prev_next_img.previous.key):curr_prev_next_img.next!==!1&&(document.location="?i="+curr_prev_next_img.next.key)},!1)):(curr_prev_next_img.previous!==!1&&(previous=document.createElement("a"),previous.className="image-container-previous",previous.href="?i="+curr_prev_next_img.previous.key,previous.text="◄",document.body.appendChild(previous)),curr_prev_next_img.next!==!1&&(next=document.createElement("a"),next.className="image-container-next",next.href="?i="+curr_prev_next_img.next.key,next.text="►",document.body.appendChild(next)),document.onkeydown=function(e){switch(e=e||window.event,e.which||e.keyCode){case 37:curr_prev_next_img.previous!==!1&&(document.location="?i="+curr_prev_next_img.previous.key);break;case 39:curr_prev_next_img.next!==!1&&(document.location="?i="+curr_prev_next_img.next.key)}}),galinear_prefs.toolbar&&(home=document.createElement("a"),home.className="home",home.href=galinear_opt.gallery_url,home.title=galinear_opt.txt_home,permalink=document.createElement("a"),permalink.className="permalink",image.guid&&(permalink.href=image.guid),permalink.title=galinear_opt.txt_permalink,source=document.createElement("a"),source.className="source",source.href=img.src,source.title=galinear_opt.txt_source,toolbar=document.createElement("div"),toolbar.className="image-container-alone-toolbar",toolbar.appendChild(home),toolbar.appendChild(permalink),toolbar.appendChild(source),document.body.appendChild(toolbar))),window.onload=ambilight_effect}else{var gallery_images=[],linear_me=function(){if("undefined"==typeof gallery)return document.write("<p>"+galinear_opt.txt_no_img+"</p>"),void 0;var e,t,i,s,n,o,a,r,c,l,p="",d=0,u=1,f=0,m=gallery.length,g=document.getElementById("image-container"),h=Math.ceil(m/galinear_prefs.per_page);if(params.p&&!params.d&&(u=parseInt(params.p,10),1>u&&(u=1),u>h&&(u=h),f=(u-1)*galinear_prefs.per_page),navigator.cookieEnabled){var v=document.createElement("div"),_=document.createElement("a"),b=document.createElement("a");p=galinear_prefs.toolbar?galinear_opt.txt_pref_toolbar:galinear_opt.txt_pref_toolbar_no,_.text="♆",_.title=p,_.className=galinear_prefs.toolbar?"enabled":"disabled",add_event(_,"click",function(){galinear_prefs.toolbar=!galinear_prefs.toolbar+0,_.className=galinear_prefs.toolbar?"enabled":"disabled",p=galinear_prefs.toolbar?galinear_opt.txt_pref_toolbar:galinear_opt.txt_pref_toolbar_no,_.title=p,store_cookie()}),v.appendChild(_),p=galinear_prefs.show_nsfw?galinear_opt.txt_pref_show_nsfw:galinear_opt.txt_pref_show_nsfw_no,b.text="☂",b.title=p,b.className=galinear_prefs.show_nsfw?"disabled":"enabled",add_event(b,"click",function(){galinear_prefs.show_nsfw=!galinear_prefs.show_nsfw+0,b.className=galinear_prefs.show_nsfw?"disabled":"enabled",p=galinear_prefs.show_nsfw?galinear_opt.txt_pref_show_nsfw_no:galinear_opt.txt_pref_show_nsfw,b.title=p,store_cookie(),location.reload(!0)}),v.appendChild(b),v.className="prefs",g.appendChild(v)}if(0===gallery_images.length){if(params.d){for(l=[],e=0;m>e;e+=1)parse_date(gallery[e].date)===params.d&&l.push(gallery[e]);gallery=l,m=gallery.length}for(e=f;m>e&&d<galinear_prefs.per_page;e+=1,d+=1)a=document.createElement("img"),a.width=gallery[e].w,a.height=gallery[e].h,a.src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=",a.setAttribute("data-type","fake"),o=document.createElement("img"),o.width=gallery[e].w,o.height=gallery[e].h,o.setAttribute("data-type","zzzblah"),n=document.createElement("a"),n.href="?i="+gallery[e].key,n.appendChild(o),n.appendChild(a),s=document.createElement("figure"),s.appendChild(n),gallery[e].nsfw&&!galinear_prefs.show_nsfw&&(s.className="nsfw"),g.appendChild(s),gallery_images.push({originalImage:o,fakeImage:a,width:gallery[e].w,height:gallery[e].h,nsfw:gallery[e].nsfw})}if(0===m)return document.write("<p>"+galinear_opt.txt_no_img+"</p>"),void 0;for(c=linearPartitionFitPics(gallery_images,{containerWidth:document.documentElement.clientWidth-16,preferedImageHeight:parseInt((document.documentElement.clientHeight-25)/galinear_prefs.lines,10),spacing:4}),i=g.getElementsByTagName("figure"),e=0,m=gallery_images.length;m>e;e+=1)t=gallery_images[e],t.fakeImage.width=c[e].width,t.fakeImage.height=c[e].height,t.fakeImage.style.marginLeft="-"+c[e].width+"px",t.originalImage.width=c[e].width,t.originalImage.height=c[e].height,add_event(t.originalImage,"load",function(e){e.style.opacity=0,e.style.zIndex=0}(t.fakeImage)),t.originalImage.src=galinear_opt.thumb_folder+gallery[f+e].src,t.last||(i[e].style.marginRight="4px"),gallery_images[e].nsfw&&!galinear_prefs.show_nsfw&&c[e].width<95&&(document.getElementsByTagName("figure")[e].style.backgroundSize="contain");i[m-1].style.marginBottom="8px",!params.d&&h>1&&(r=document.createElement("div"),p="",u>0&&h>u&&(p+='<a href="?p='+(u+1)+'">'+galinear_opt.txt_older+"</a> &nbsp; "),p+=" &nbsp; page "+u+"/"+h+" &nbsp; ",u>1&&(p+=' &nbsp; <a href="?p='+(u-1)+'">'+galinear_opt.txt_newer+"</a>"),r.innerHTML=p,r.className="footer",g.appendChild(r)),galinear_opt.touch_support||(document.onkeydown=function(e){switch(e=e||window.event,e.which||e.keyCode){case 37:u>0&&h>u&&(document.location="?p="+(u+1));break;case 39:u>1&&(document.location="?p="+(u-1))}})};window.onload=linear_me}
