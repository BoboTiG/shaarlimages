function linearPartitionFitPics(e,t){"use strict";t.border=t.border||0,t.spacing=t.spacing||0;var a,r,n,i,o,l,s,p,g=0,c=0,_=0,m=[],d=[],h=function(e,t){var a,r,n,i,o=e.length,l=[],s=[],p=[],g=[],c={};for(a=0;o>a;a+=1){for(l=[],r=0;t>r;r+=1)l.push(0);s.push(l)}for(a=0;o-1>a;a+=1){for(l=[],r=0;t-1>r;r+=1)l.push(0);p.push(l)}for(a=0;o>a;a+=1)s[a][0]=e[a]+(a?s[a-1][0]:0);for(a=0;t>a;a+=1)s[0][a]=e[0];for(a=1;o>a;a+=1)for(r=1;t>r;r+=1){for(g=[],n=0;a>n;n+=1)g.push([Math.max(s[n][r-1],s[a][0]-s[n][0]),n]);for(c={computed:1/0,value:1/0},n=0,i=g.length;i>n;n+=1)g[n][0]<c.computed&&(c={value:g[n],computed:g[n][0]});s[a][r]=c.value[0],p[a-1][r-1]=c.value[1]}return[s,p]},u=function(e,t){var a,r,n,i=e.length-1,o=[],l=[],s=[];if(1>t)return l;if(t>i){for(a=0;i>=a;a+=1)l.push([e[a]]);return l}for(n=h(e,t),r=n[1],t-=2;t>=0;){for(s=[],a=r[i-1][t]+1;i>=a;a+=1)s.push(e[a]);s=[s],o=s.concat(o),i=r[i-1][t],t-=1}for(a=0;i>=a;a+=1)l.push(e[a]);return l=[l],l.concat(o)};for(a=0,n=e.length;n>a;a+=1)e[a].aspectRatio=e[a].width/e[a].height,c+=e[a].aspectRatio*t.preferedImageHeight;if(o=Math.round(c/t.containerWidth),1>=o)for(a=0,n=e.length;n>a;a+=1)e[a].width=parseInt(t.preferedImageHeight*e[a].aspectRatio,10),e[a].height=t.preferedImageHeight;else{for(a=0,n=e.length;n>a;a+=1)m.push(parseInt(100*e[a].aspectRatio,10));i=u(m,o);for(a in i){for(l=i[a],s=t.containerWidth,_=0,d=[],n=l.length,t.spacing&&(s-=t.spacing*(n-1)),r=0;n>r;r+=1)d.push(e[g]),g+=1;for(r=0,n=d.length;n>r;r+=1)_+=d[r].aspectRatio;for(r=0;n>r;r+=1)p=d[r],p.width=parseInt(s/_*p.aspectRatio,10),p.height=parseInt(s/_,10),r===n-1&&(p.last=!0)}}return e}function ambilight_effect(){"use strict";var e,t=document.getElementsByTagName("img")[0],a=document.createElement("canvas"),r=a.getContext("2d"),n="assets/img/mask.png",i=new Image,o=150,l=function(e,t,a){var r,n=[0,0,0],i=(a-t)/4;for(r=t;a>=r;r+=4)n[0]+=e[r],n[1]+=e[r+1],n[2]+=e[r+2];return n[0]=Math.round(n[0]/i),n[1]=Math.round(n[1]/i),n[2]=Math.round(n[2]/i),n},s=function(e,t,a){var r,n,i=e.width,o=e.height,s=5,p=Math.ceil(o/s),g=a*p*4,c=[],_=t.getImageData(0,0,a,o),m=_.data.length;for(r=0;s>r;r+=1)n=r*i*a,c.push(l(_.data,r*g,Math.min((r+1)*g,m-1)));return c},p=function(e,a){var r,n,i,o,l=e,p=document.createElement("canvas"),g=p.getContext("2d");for(p.style.position="absolute",p.style.top="0",p.style.zIndex="-2",p.style.width="100%",p.style.height="100%",p.width=e,p.height=t.height,a&&(l=t.width-e),g.drawImage(t,l,0,p.width,p.height,0,0,p.width,p.height),i=s(p,g,e),o=g.createLinearGradient(0,0,0,p.height),r=0,n=i.length;n>r;r+=1)o.addColorStop(r/n,"rgb("+i[r]+")");return g.fillStyle=o,g.fillRect(0,0,p.width,p.height),p};e=p(o,!1),e.style.left="0",document.body.appendChild(e),a.style.position="absolute",a.style.top="0",a.style.left="0",a.style.zIndex="-1",a.style.width="100%",a.style.height="100%",i.src=n,a.width=i.width,a.height=i.height,r.drawImage(i,0,0,a.width,a.height),document.body.appendChild(a)}function parse_query_string(){"use strict";var e=window.location.search,t={};return e.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),function(e,a,r,n){t[a]=n}),t}function add_event(e,t,a){"use strict";return e.attachEvent?e.attachEvent("on"+t,a):e.addEventListener(t,a,!1)}function parse_date(e){"use strict";var t=new Date(1e3*e),a=t.getFullYear().toString(),r=(t.getMonth()+1).toString(),n=t.getDate().toString();return 1===r.length&&(r="0"+r),1===n.length&&(n="0"+n),a+r+n}function store_cookie(){"use strict";var e=new Date,t=new Date(e.getTime()+31536e6),a="prefs="+JSON.stringify(galinear_prefs)+";expires="+t+";";navigator.cookieEnabled&&(document.cookie=a)}function read_cookie(){"use strict";var e,t,a;if(navigator.cookieEnabled&&document.cookie.length>0){a=document.cookie.split("; ");for(e in a)if("prefs"==a[e].split("=")[0]){t=JSON.parse(a[e].split("=")[1]);for(e in t)t[e]=parseInt(t[e],10),isNaN(t[e])&&(t[e]=0);return t}}return galinear_prefs}if(!galinear_opt)var galinear_opt={gallery_url:"/",img_folder:"images/",thumb_folder:"images/thumbs/",txt_no_img:"Aucune image ☹",txt_older:"◄ Vieilleries",txt_newer:"Nouveautés ►",txt_home:"Retour à la galerie",txt_permalink:"Lien source",txt_source:"Image originale",txt_pref_toolbar:"La barre d'outils est affichée",txt_pref_toolbar_no:"La barre d'outils n'est pas affichée",txt_pref_show_nsfw:"Les images sensibles ne sont pas filtrées",txt_pref_show_nsfw_no:"Les images sensibles sont filtrées",touch_support:"ontouchend"in document};if(!galinear_prefs)var galinear_prefs={per_page:20,lines:3,show_nsfw:0,toolbar:1};var params=parse_query_string();if(params.per_page&&(galinear_prefs.per_page=parseInt(params.per_page,10)),params.lines&&(galinear_prefs.lines=parseInt(params.lines,10)),params.show_nsfw&&(galinear_prefs.show_nsfw=parseInt(params.show_nsfw,10)),params.toolbar&&(galinear_prefs.toolbar=parseInt(params.toolbar,10)),params.search=params.search||params.searchtags||params.searchterms,galinear_prefs=read_cookie(),galinear_prefs.per_page<10&&(galinear_prefs.per_page=10),galinear_prefs.lines<2&&(galinear_prefs.lines=2),1!==galinear_prefs.show_nsfw&&(galinear_prefs.show_nsfw=0),1!==galinear_prefs.toolbar&&(galinear_prefs.toolbar=0),params.search&&(galinear_prefs.per_page=1024),params.i&&gallery.length>0){var figure,img,title,toolbar,home,permalink,source,previous,next,start=0,curr_prev_next=function(e){var t,a=gallery.length,r=!1,n=!1,i=!1;for(t=0;a>t;t+=1)if(gallery[t].k===e){r=gallery[t],t>0&&(n=gallery[t-1]),a-1>t&&(i=gallery[t+1]);break}return{current:r,previous:n,next:i}},curr_prev_next_img=curr_prev_next(params.i),image=curr_prev_next_img.current;image===!1?document.write("<p>"+galinear_opt.txt_no_img+"</p>"):(title="",image.n&&(title+="[ ☂ NSFW ] "),title+=image.s+" - "+document.title,document.title=title,img=document.createElement("img"),img.src=galinear_opt.img_folder+image.s,figure=document.createElement("figure"),figure.className="image-container-alone",figure.appendChild(img),document.body.appendChild(figure),galinear_opt.touch_support?(add_event(document,"touchstart",function(e){start=e.targetTouches[0].clientX},!1),add_event(document,"touchmove",function(e){e.preventDefault(),start-e.targetTouches[0].clientX<0?curr_prev_next_img.previous!==!1&&(document.location="?i="+curr_prev_next_img.previous.k):curr_prev_next_img.next!==!1&&(document.location="?i="+curr_prev_next_img.next.k)},!1)):(curr_prev_next_img.previous!==!1&&(previous=document.createElement("a"),previous.className="image-container-previous",previous.href="?i="+curr_prev_next_img.previous.k,previous.text="⍃",document.body.appendChild(previous)),curr_prev_next_img.next!==!1&&(next=document.createElement("a"),next.className="image-container-next",next.href="?i="+curr_prev_next_img.next.k,next.text="⍄",document.body.appendChild(next)),document.onkeydown=function(e){switch(e=e||window.event,e.which||e.keyCode){case 37:curr_prev_next_img.previous!==!1&&(document.location="?i="+curr_prev_next_img.previous.k);break;case 39:curr_prev_next_img.next!==!1&&(document.location="?i="+curr_prev_next_img.next.k)}}),galinear_prefs.toolbar&&(home=document.createElement("a"),home.className="home",home.href=galinear_opt.gallery_url,home.title=galinear_opt.txt_home,permalink=document.createElement("a"),permalink.className="permalink",image.g&&(permalink.href=image.g),permalink.title=galinear_opt.txt_permalink,source=document.createElement("a"),source.className="source",source.href=img.src,source.title=galinear_opt.txt_source,toolbar=document.createElement("div"),toolbar.className="image-container-alone-toolbar",toolbar.appendChild(home),toolbar.appendChild(permalink),toolbar.appendChild(source),document.body.appendChild(toolbar))),window.onload=ambilight_effect}else{var gallery_images=[],linear_me=function(){if("undefined"==typeof gallery)return document.write("<p>"+galinear_opt.txt_no_img+"</p>"),void 0;var e,t,a,r,n,i,o,l,s="",p=0,g=1,c=0,_=gallery.length,m=document.getElementById("image-container"),d=Math.ceil(_/galinear_prefs.per_page);if(params.p&&!params.d&&(g=parseInt(params.p,10),1>g&&(g=1),g>d&&(g=d),c=(g-1)*galinear_prefs.per_page),0===gallery_images.length){if(params.d){for(l=[],e=0;_>e;e+=1)parse_date(gallery[e].d)===params.d&&l.push(gallery[e]);gallery=l,_=gallery.length}for(e=c;_>e&&p<galinear_prefs.per_page;e+=1,p+=1)n=document.createElement("img"),r=document.createElement("a"),r.href="?i="+gallery[e].k,r.style.width=gallery[e].w+"px",r.style.height=gallery[e].h+"px",r.appendChild(n),gallery[e].n&&!galinear_prefs.show_nsfw&&(r.className="nsfw"),m.appendChild(r),gallery_images.push({originalImage:n,width:gallery[e].w,height:gallery[e].h,nsfw:gallery[e].n})}if(0===_)return document.write("<p>"+galinear_opt.txt_no_img+"</p>"),void 0;for(o=linearPartitionFitPics(gallery_images,{containerWidth:document.documentElement.clientWidth-16,preferedImageHeight:parseInt(document.documentElement.clientHeight/galinear_prefs.lines,10),spacing:4}),a=m.getElementsByTagName("a"),e=0,_=gallery_images.length;_>e;e+=1)t=gallery_images[e],a[e].style.width=o[e].width+"px",a[e].style.height=o[e].height+"px",t.originalImage.width=o[e].width,t.originalImage.height=o[e].height,t.originalImage.src=galinear_opt.thumb_folder+gallery[c+e].s,add_event(t.originalImage,"load",function(e){e.className="show-off"}(t.originalImage)),t.last||(a[e].style.marginRight="4px"),gallery_images[e].nsfw&&!galinear_prefs.show_nsfw&&o[e].width<95&&(a[e].style.backgroundSize="contain");if(a[_-1].style.marginBottom="8px",!params.search&&!params.d&&d>1&&(i=document.createElement("footer"),s="",g>0&&d>g&&(s+='<a href="?p='+(g+1)+'">'+galinear_opt.txt_older+"</a> &nbsp; "),s+=" &nbsp; page "+g+"/"+d+" &nbsp; ",g>1&&(s+=' &nbsp; <a href="?p='+(g-1)+'">'+galinear_opt.txt_newer+"</a>"),i.innerHTML=s,document.body.appendChild(i),navigator.cookieEnabled)){var h=document.createElement("div"),u=document.createElement("a"),f=document.createElement("a");s=galinear_prefs.toolbar?galinear_opt.txt_pref_toolbar:galinear_opt.txt_pref_toolbar_no,u.text="♆",u.title=s,u.className=galinear_prefs.toolbar?"enabled":"disabled",add_event(u,"click",function(){galinear_prefs.toolbar=!galinear_prefs.toolbar+0,u.className=galinear_prefs.toolbar?"enabled":"disabled",s=galinear_prefs.toolbar?galinear_opt.txt_pref_toolbar:galinear_opt.txt_pref_toolbar_no,u.title=s,store_cookie()}),h.appendChild(u),s=galinear_prefs.show_nsfw?galinear_opt.txt_pref_show_nsfw:galinear_opt.txt_pref_show_nsfw_no,f.text="☂",f.title=s,f.className=galinear_prefs.show_nsfw?"disabled":"enabled",add_event(f,"click",function(){galinear_prefs.show_nsfw=!galinear_prefs.show_nsfw+0,f.className=galinear_prefs.show_nsfw?"disabled":"enabled",s=galinear_prefs.show_nsfw?galinear_opt.txt_pref_show_nsfw_no:galinear_opt.txt_pref_show_nsfw,f.title=s,store_cookie(),location.reload(!0)}),h.appendChild(f),h.className="prefs",m.appendChild(h)}galinear_opt.touch_support||(document.onkeydown=function(e){switch(e=e||window.event,e.which||e.keyCode){case 37:g>0&&d>g&&(document.location="?p="+(g+1));break;case 39:g>1&&(document.location="?p="+(g-1))}})};window.onload=linear_me}
